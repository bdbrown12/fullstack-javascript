<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">

    <!--Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <title>Tic Tac Toe</title>
</head>
<body>
    <header>
        <h1 class="press-start-2p-regular">Tic Tac Toe</h1>
    </header>

    <div class="button-container">
        <button id="btn-start">Start</button>
        <button id="btn-reset">Reset</button>
    </div>

    <div class="grid-container">
        <div class="grid">
            <div class="cell" id="cell-1"></div>
            <div class="cell" id="cell-2"></div>
            <div class="cell" id="cell-3"></div>
            <div class="cell" id="cell-4"></div>
            <div class="cell" id="cell-5"></div>
            <div class="cell" id="cell-6"></div>
            <div class="cell" id="cell-7"></div>
            <div class="cell" id="cell-8"></div>
            <div class="cell" id="cell-9"></div>
        </div>
    </div>

    <dialog class="modal" id="modal">
        <h1>Enter Player Information</h1>
        <form id="player-form">
            <div>
                <label for="playerName">Player Name: </label>
                <input style="display: block;" type="text" id="playerName">
            </div>
            <div>
                <p>Choose your marker</p>
                <input type="radio" name="playerMarker" id="X">
                <label for="playerMarker">X</label>
                <input type="radio" name="playerMarker" id="O">
                <label for="playerMarker">O</label>
            </div>
            <div class="button-container" style="position: absolute; bottom: 10px;">
                <button id="btn-submit-player">Submit</button>
                <button id="btn-close-modal">Close</button>
            </div>
        </form>
    </dialog>

    <script>
        const modal = document.querySelector('#modal')
        const openStart = document.querySelector("#btn-start");
        const closeStart = document.querySelector("#btn-close-modal");
        const cells = document.querySelectorAll(".cell");
        const playerForm = document.querySelector("#player-form");
        const btnReset = document.querySelector("#btn-reset");

        playerForm.addEventListener("submit", (e) => {
            e.preventDefault();
            //formValidation(//return true or false)
            const inputName = document.querySelector("#playerName");
            const selectedMarker = document.querySelector("input[name='playerMarker']:checked");

            //remove existing validation messages if any
            const existingMsg = document.querySelector(".validation-message");
            if (existingMsg){
                existingMsg.remove();
            }

            //check if name is valid
            if(inputName.value.trim() === ""){
               const validationMsg = document.createElement("div")
               validationMsg.innerHTML = "Please enter a name.";
               validationMsg.classList.add("validation-message");
 
               inputName.insertAdjacentElement("afterend", validationMsg);
               return; //Stop execution if validation fails
            } 

            //check if radio button is selected
            if(!selectedMarker){
                const validationMsg = document.createElement("div");
                validationMsg.innerHTML = "Please select a marker";
                validationMsg.classList.add("validation-message");
                inputName.insertAdjacentElement("afterend", validationMsg);
                return;
            }

            //create a new player
            const newPlayer = Player(inputName.value.trim(), selectedMarker.id);
            
            //get the opposite of player marker and use that to create a new opponent
            const opponentMarker = selectedMarker.id === "X" ? "O" : "X";
            const opponent = Player("opponent", opponentMarker, undefined, false);

            // Close the modal after successful form submission
            modal.style.opacity = 0;
            modal.style.transition = 'opacity 200ms';  // Smooth transition

            // Close Modal
            setTimeout(() => {
                modal.close();  // Close the modal
                modal.style.display = 'none';  // Ensure it doesn't occupy space
            }, 200);

            runGame(newPlayer, opponent);

        });

        function runGame(player, opponent){
            //possible need to destructure to access properties 

            //create the gameboard
            let gameboard = Array(9).fill(null);

            function opponentTurn() {
                let availableSpaces = [];

                gameboard.forEach((cell, index) =>{
                    if (cell === null || cell === ''){
                        availableSpaces.push(index);
                    }
                });

                    if (availableSpaces.length === 0) return 'Game over';

                    let randomIndex = availableSpaces[Math.floor(Math.random() * availableSpaces.length)]

                    //update gameboard and UI
                    gameboard[randomIndex] = opponent.marker;
                    cells[randomIndex].textContent = opponent.marker;

                    //switch to players turn
                
            }

            //call playerTurn() if gameboard is NOT full and game does NOT have winner
            
            //call opponentTurn()

                //if gameboard[index] is empty, opponent randomly places marker
                cells.forEach((cell, index) => {
                    let opponentSelection = 1; //some randomly generated number between 0 and 8

                    //check if the opponents selection is valid

                    //what makes their selection valid? 
                        // (1) the generated number has to be available in the array && (2) gameboard[index] has to be empty or null


                            //how can I ensure that the generated number is available in the array?
                                // only let the opponent see indexes that are NOT null or ''
                                    //how do I only let the opponent see these array elements?
                                        // get gameboard[index] WHERE index is not null or '' and store them in a variable i.e. opponentOptions[] (this needs to remain a reference)
                                            //opponentOptions [] = 

                                            //if (!gameboard[index])
                                                //return array[index] //use this as computer options


                                        // randomly select from an index in opponentOptions

                        // 


                    //if !gameboard[opponentSelection]
                        // change marker in dom
                            //cell.textContent = opponent.marker
                        // update opponents selected index marker in array
                            //how do i change an index marker in an array?
                                //array[index] = opponent.marker
                            //gameboard[index] = opponent.marker
                    //else
                });
                //switch turns

            //do i need to return the array after each turn or how do i keep it updated?


            function playerTurn(){
                //only clear the marker if the cell is empty
                cells.forEach((cell, index) =>{
                    //only show the marker if the cell is empty
                    cell.addEventListener('mouseenter', () => {
                        if(!gameboard[index]){
                            cell.style.cursor = "pointer";
                            cell.textContent = player.marker;
                        }
                    });

                    cell.addEventListener('mouseleave', () => {
                        if(!gameboard[index]){
                            cell.textContent = "";
                        }
                    });

                    cell.addEventListener('click', () => {
                        if(!gameboard[index]){
                        cell.textContent = player.marker;
                        gameboard[index] = player.marker;
                        cell.style.color = "black";
                        //player turn ends
                        player.isTurn = false;

                        //opponent turn begins
                        opponent.isTurn = true;
                        console.log(opponent.isTurn);
                        }
                    });
                });
            }

            //opponentTurn()






        }



        btnReset.addEventListener('click', () => {
            window.location.reload();
        });

        openStart.addEventListener('click', () => {
            modal.showModal();
            modal.style.opacity = 1;
            modal.style.transition = '200ms';
        });

        closeStart.addEventListener('click', () => {
            modal.style.opacity = 0;
            setTimeout(() => {
            modal.close();
        }, 200); // Wait for 200ms before closing
        });

        function Player(name, marker, score) {
        return {name, marker, score: 0, isTurn: true};
        }
    </script>
    
</body>
</html>